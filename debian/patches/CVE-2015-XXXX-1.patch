From 6e5cda0b4d243c34bfc1c15e252f495c8d558491 Mon Sep 17 00:00:00 2001
From: Alan Coopersmith <alan.coopersmith@oracle.com>
Date: Fri, 6 Feb 2015 15:50:45 -0800
Subject: [PATCH:libXfont 1/3] bdfReadProperties: property count needs range
 check [CVE-2015-AAAA]

Avoid integer overflow or underflow when allocating memory arrays
by multiplying the number of properties reported for a BDF font.

Reported-by: Ilja Van Sprundel <ivansprundel@ioactive.com>
Signed-off-by: Alan Coopersmith <alan.coopersmith@oracle.com>
Reviewed-by: Julien Cristau <jcristau@debian.org>
---
 src/bitmap/bdfread.c |    4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

Index: libxfont-1.4.1/src/bitmap/bdfread.c
===================================================================
--- libxfont-1.4.1.orig/src/bitmap/bdfread.c	2015-03-27 12:54:13.000000000 +0100
+++ libxfont-1.4.1/src/bitmap/bdfread.c	2015-03-27 12:54:13.000000000 +0100
@@ -601,7 +601,9 @@
 	bdfError("missing 'STARTPROPERTIES'\n");
 	return (FALSE);
     }
-    if (sscanf((char *) line, "STARTPROPERTIES %d", &nProps) != 1) {
+    if ((sscanf((char *) line, "STARTPROPERTIES %d", &nProps) != 1) ||
+	(nProps <= 0) ||
+	(nProps > ((INT32_MAX / sizeof(FontPropRec)) - BDF_GENPROPS))) {
 	bdfError("bad 'STARTPROPERTIES'\n");
 	return (FALSE);
     }
